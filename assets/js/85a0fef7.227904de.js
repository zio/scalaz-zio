"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[29035],{44951:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>c,contentTitle:()=>t,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>g});const i=JSON.parse('{"id":"zio-logging/metrics","title":"Log Metrics","description":"Log metrics collecting metrics related to ZIO logging (all ZIO.log* functions).","source":"@site/docs/zio-logging/metrics.md","sourceDirName":"zio-logging","slug":"/zio-logging/metrics","permalink":"/zio-logging/metrics","draft":false,"unlisted":false,"editUrl":"https://github.com/zio/zio/edit/series/2.x/docs/zio-logging/metrics.md","tags":[],"version":"current","frontMatter":{"id":"metrics","title":"Log Metrics"},"sidebar":"ecosystem-sidebar","previous":{"title":"SLF4J v1 bridge","permalink":"/zio-logging/slf4j1-bridge"},"next":{"title":"Testing","permalink":"/zio-logging/testing"}}');var l=n(74848),r=n(28453);const s={id:"metrics",title:"Log Metrics"},t=void 0,c={},g=[{value:"Examples",id:"examples",level:2},{value:"Console logger with metrics",id:"console-logger-with-metrics",level:3}];function a(e){const o={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(o.p,{children:["Log metrics collecting metrics related to ZIO logging (all ",(0,l.jsx)(o.code,{children:"ZIO.log*"})," functions).\nAs ZIO core supporting multiple loggers, this logging metrics collector is implemented as specific ",(0,l.jsx)(o.code,{children:"ZLogger"}),"\nwhich is responsible just for collecting metrics of all logs - ",(0,l.jsx)(o.code,{children:"ZIO.log*"})," functions."]}),"\n",(0,l.jsx)(o.p,{children:"The Metrics layer"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-scala",children:"val layer = zio.logging.logMetrics\n"})}),"\n",(0,l.jsxs)(o.p,{children:["will add a default metric named ",(0,l.jsx)(o.code,{children:"zio_log_total"})," with the label ",(0,l.jsx)(o.code,{children:"level"})," which will be\nincremented for each log message with the value of ",(0,l.jsx)(o.code,{children:"level"})," being the corresponding log level label in lower case."]}),"\n",(0,l.jsx)(o.p,{children:"Metrics:"}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"LogLevel.All"})," -> ",(0,l.jsx)(o.code,{children:"all"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"LogLevel.Fatal"})," -> ",(0,l.jsx)(o.code,{children:"fatal"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"LogLevel.Error"})," -> ",(0,l.jsx)(o.code,{children:"error"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"LogLevel.Warning"})," -> ",(0,l.jsx)(o.code,{children:"warn"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"LogLevel.Info"})," -> ",(0,l.jsx)(o.code,{children:"info"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"LogLevel.Debug"})," -> ",(0,l.jsx)(o.code,{children:"debug"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"LogLevel.Trace"})," -> ",(0,l.jsx)(o.code,{children:"trace"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"LogLevel.None"})," -> ",(0,l.jsx)(o.code,{children:"off"})]}),"\n"]}),"\n",(0,l.jsx)(o.p,{children:"Custom names for the metric and label can be set via:"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-scala",children:'val layer = zio.logging.logMetricsWith("log_counter", "log_level")\n'})}),"\n",(0,l.jsx)(o.h2,{id:"examples",children:"Examples"}),"\n",(0,l.jsxs)(o.p,{children:["You can find the source\ncode ",(0,l.jsx)(o.a,{href:"https://github.com/zio/zio-logging/tree/master/examples",children:"here"})]}),"\n",(0,l.jsx)(o.h3,{id:"console-logger-with-metrics",children:"Console logger with metrics"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-scala",children:'package zio.logging.example\n\nimport zio.logging.{ consoleLogger, logMetrics }\nimport zio.metrics.connectors.MetricsConfig\nimport zio.metrics.connectors.prometheus.{ PrometheusPublisher, prometheusLayer, publisherLayer }\nimport zio.{ ExitCode, Runtime, Scope, ZIO, ZIOAppArgs, ZIOAppDefault, ZLayer, _ }\n\nobject MetricsApp extends ZIOAppDefault {\n\n  override val bootstrap: ZLayer[ZIOAppArgs, Any, Any] =\n    Runtime.removeDefaultLoggers >>> (consoleLogger() ++ logMetrics)\n\n  override def run: ZIO[Scope, Any, ExitCode] =\n    (for {\n      _            <- ZIO.logInfo("Start")\n      _            <- ZIO.logWarning("Some warning")\n      _            <- ZIO.logError("Some error")\n      _            <- ZIO.logError("Another error")\n      _            <- ZIO.sleep(1.second)\n      metricValues <- ZIO.serviceWithZIO[PrometheusPublisher](_.get)\n      _            <- Console.printLine(metricValues)\n      _            <- ZIO.logInfo("Done")\n    } yield ExitCode.success)\n      .provideLayer((ZLayer.succeed(MetricsConfig(200.millis)) ++ publisherLayer) >+> prometheusLayer)\n\n}\n'})}),"\n",(0,l.jsx)(o.p,{children:"Expected Console Output:"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{children:'timestamp=2023-03-15T08:44:39.93193+01:00  level=INFO thread=zio-fiber-6 message="Start"\ntimestamp=2023-03-15T08:44:39.951764+01:00 level=WARN thread=zio-fiber-6 message="Some warning"\ntimestamp=2023-03-15T08:44:39.95388+01:00  level=ERROR thread=zio-fiber-6 message="Some error"\ntimestamp=2023-03-15T08:44:39.954738+01:00 level=ERROR thread=zio-fiber-6 message="Another error"\n# TYPE zio_log_total counter\n# HELP zio_log_total\nzio_log_total{level="error",} 2.0 1678866280778\n# TYPE zio_log_total counter\n# HELP zio_log_total\nzio_log_total{level="warn",} 1.0 1678866280778\n# TYPE zio_log_total counter\n# HELP zio_log_total\nzio_log_total{level="info",} 1.0 1678866280778\ntimestamp=2023-03-15T08:44:40.972877+01:00 level=INFO thread=zio-fiber-6 message="Done"\n'})})]})}function d(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,l.jsx)(o,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},28453:(e,o,n)=>{n.d(o,{R:()=>s,x:()=>t});var i=n(96540);const l={},r=i.createContext(l);function s(e){const o=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),i.createElement(r.Provider,{value:o},e.children)}}}]);