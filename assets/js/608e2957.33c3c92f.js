"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[89283],{10781:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>d,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"zio-lambda/index","title":"Introduction to ZIO Lambda","description":"A ZIO-based AWS Custom Runtime compatible with GraalVM Native Image.","source":"@site/docs/zio-lambda/index.md","sourceDirName":"zio-lambda","slug":"/zio-lambda/","permalink":"/zio-lambda/","draft":false,"unlisted":false,"editUrl":"https://github.com/zio/zio/edit/series/2.x/docs/zio-lambda/index.md","tags":[],"version":"current","frontMatter":{"id":"index","title":"Introduction to ZIO Lambda","sidebar_label":"ZIO Lambda"},"sidebar":"ecosystem-sidebar","previous":{"title":"Migrating to zio-kafka 3","permalink":"/zio-kafka/migrating-to-zio-kafka-3"},"next":{"title":"Introduction","permalink":"/zio-logging/"}}');var t=n(74848),s=n(28453);const o={id:"index",title:"Introduction to ZIO Lambda",sidebar_label:"ZIO Lambda"},r=void 0,d={},l=[{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"Lambda layer",id:"lambda-layer",level:2},{value:"Direct deployment of native image binary",id:"direct-deployment-of-native-image-binary",level:2},{value:"Deployment of native image binary in a Docker container",id:"deployment-of-native-image-binary-in-a-docker-container",level:2}];function c(e){const a={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.p,{children:"A ZIO-based AWS Custom Runtime compatible with GraalVM Native Image."}),"\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.a,{href:"https://github.com/zio/zio/wiki/Project-Stages",children:(0,t.jsx)(a.img,{src:"https://img.shields.io/badge/Project%20Stage-Development-green.svg",alt:"Development"})})," ",(0,t.jsx)(a.img,{src:"https://github.com/zio/zio-lambda/workflows/CI/badge.svg",alt:"CI Badge"})," ",(0,t.jsx)(a.a,{href:"https://oss.sonatype.org/content/repositories/releases/dev/zio/zio-lambda_2.13/",children:(0,t.jsx)(a.img,{src:"https://img.shields.io/nexus/r/https/oss.sonatype.org/dev.zio/zio-lambda_2.13.svg?label=Sonatype%20Release",alt:"Sonatype Releases"})})," ",(0,t.jsx)(a.a,{href:"https://oss.sonatype.org/content/repositories/snapshots/dev/zio/zio-lambda_2.13/",children:(0,t.jsx)(a.img,{src:"https://img.shields.io/nexus/s/https/oss.sonatype.org/dev.zio/zio-lambda_2.13.svg?label=Sonatype%20Snapshot",alt:"Sonatype Snapshots"})})," ",(0,t.jsx)(a.a,{href:"https://javadoc.io/doc/dev.zio/zio-lambda-docs_2.13",children:(0,t.jsx)(a.img,{src:"https://javadoc.io/badge2/dev.zio/zio-lambda-docs_2.13/javadoc.svg",alt:"javadoc"})})," ",(0,t.jsx)(a.a,{href:"https://github.com/zio/zio-lambda",children:(0,t.jsx)(a.img,{src:"https://img.shields.io/github/stars/zio/zio-lambda?style=social",alt:"ZIO Lambda"})})]}),"\n",(0,t.jsx)(a.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-scala",children:'libraryDependencies += "dev.zio" %% "zio-json" % "0.6.2"\nlibraryDependencies += "dev.zio" %% "zio-lambda" % "1.0.5"\n\n// Optional dependencies\nlibraryDependencies += "dev.zio" %% "zio-lambda-event"    % "1.0.5"\nlibraryDependencies += "dev.zio" %% "zio-lambda-response" % "1.0.5"\n'})}),"\n",(0,t.jsx)(a.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsxs)(a.p,{children:["Create your Lambda function by providing it to ",(0,t.jsx)(a.code,{children:"ZLambdaRunner.serve(...)"})," method."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-scala",children:'import zio.Console._\nimport zio._\nimport zio.lambda._\n\nobject SimpleHandler extends ZIOAppDefault {\n\n   def app(request: KinesisEvent, context: Context) = for {\n      _ <- printLine(event.message)\n   } yield "Handler ran successfully"\n\n   override val run =\n      ZLambdaRunner.serve(app)\n}\n'})}),"\n",(0,t.jsxs)(a.p,{children:["zio-lambda depends on ",(0,t.jsx)(a.a,{href:"https://github.com/zio/zio-json",children:(0,t.jsx)(a.strong,{children:"zio-json"})})," for decoding any event you send to it and enconding any response you send back to the Lambda service. You can either create your own data types or use the ones that are included in ",(0,t.jsx)(a.strong,{children:"zio-lambda-event"})," and ",(0,t.jsx)(a.strong,{children:"zio-lambda-response"}),"."]}),"\n",(0,t.jsx)(a.p,{children:"The last step is to define the way your function will be invoked. There are three ways, detailed below:"}),"\n",(0,t.jsx)(a.h2,{id:"lambda-layer",children:"Lambda layer"}),"\n",(0,t.jsxs)(a.p,{children:["Upload zio-lambda as a ",(0,t.jsx)(a.a,{href:"https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html",children:"Lambda Layer"}),"\nEach release will contain a zip file ready to be used as a lambda layer) and your function. Instructions coming soon!"]}),"\n",(0,t.jsx)(a.h2,{id:"direct-deployment-of-native-image-binary",children:"Direct deployment of native image binary"}),"\n",(0,t.jsxs)(a.ol,{children:["\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"Create an AWS Lambda function and choose the runtime where you provide your own bootstrap on Amazon Linux 2"}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:"https://user-images.githubusercontent.com/14280155/164102664-3686e415-20be-4dd9-8979-ea6098a7a4b9.png",alt:"create-lambda"})}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsxs)(a.p,{children:["Run ",(0,t.jsx)(a.code,{children:"sbt GraalVMNativeImage/packageBin"}),", we'll find the binary present under the ",(0,t.jsx)(a.code,{children:"graalvm-native-image"})," folder:"]}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:"https://user-images.githubusercontent.com/14280155/164103337-6645dfeb-7fc4-4f7f-9b13-8005b0cddead.png",alt:"binary-located"})}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"Create the following bootstap file (which calls out to the binary) and place it in the same directory alongside the binary:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"#!/usr/bin/env bash\n\nset -euo pipefail\n\n./zio-lambda-example\n"})}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:"https://user-images.githubusercontent.com/14280155/164103935-0bf7a6cb-814d-4de1-8fa1-4d0d54fb6e88.png",alt:"bootstrap-alongside-native-binary"})}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"Now we can zip both these files up:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-log",children:"> pwd\n/home/cal/IdeaProjects/zio-lambda/lambda-example/target/graalvm-native-image                                                                                                                                \n> zip upload.zip bootstrap zio-lambda-example\n"})}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsxs)(a.p,{children:["Take ",(0,t.jsx)(a.code,{children:"upload.zip"})," and upload it to AWS Lambda and test your function:"]}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:"https://user-images.githubusercontent.com/14280155/164104747-039ec584-d3e2-4b47-884d-ff88977e2b53.png",alt:"lambda-ui"})}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"Test everything out to make sure everything works:"}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:"https://user-images.githubusercontent.com/14280155/164104858-a720ac55-b9bb-47ec-af70-c4bd5eb5bed3.png",alt:"test-ui"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(a.h2,{id:"deployment-of-native-image-binary-in-a-docker-container",children:"Deployment of native image binary in a Docker container"}),"\n",(0,t.jsxs)(a.p,{children:["Following the steps from ",(0,t.jsx)(a.code,{children:"Direct deployment of native image binary"})," to produce your native image binary, we can package\nup the native binary into a Docker image and deploy it like that to AWS Lambda."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-Dockerfile",children:'FROM gcr.io/distroless/base-debian12\nCOPY lambda-example/target/graalvm-native-image/zio-lambda-example /app/zio-lambda-example\nCMD ["/app/zio-lambda-example"]\n'})}),"\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.strong,{children:"NOTE:"})," This Dockerfile is meant to build the lambda-example located in the zio-lambda project and the Dockerfile is\nplaced in the zio-lambda-repository. You will need to adjust this Dockerfile to match your project needs."]}),"\n",(0,t.jsx)(a.p,{children:"Now we can build and tag the Docker image:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-shell",children:"docker build -t native-image-binary .\n"})}),"\n",(0,t.jsx)(a.p,{children:"Take this image and push it to AWS ECR:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"pass=$(aws ecr get-login-password --region us-east-1) \ndocker login --username AWS --password $pass <your_AWS_ECR_REPO>   \ndocker tag native-image-binary <your-particular-ecr-image-repository>:<your-tag>\ndocker push <your-particular-ecr-image-repository>:<your-tag>\n"})}),"\n",(0,t.jsx)(a.p,{children:"Here is an example:"}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:"https://user-images.githubusercontent.com/14280155/164120591-68a78d19-c56b-4793-96b8-cfe567443063.png",alt:"image-uploaded"})}),"\n",(0,t.jsx)(a.p,{children:"Create a Lambda function and choose container image:"}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:"https://user-images.githubusercontent.com/14280155/164120637-9c827736-26a8-4c65-92d4-2919157bbda6.png",alt:"lambda-create-container-image"})}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:"https://user-images.githubusercontent.com/14280155/164120764-2c736a46-29e3-488c-ba6a-e2b69ef51792.png",alt:"image"})}),"\n",(0,t.jsx)(a.p,{children:"Please note that because you incur the overhead of your native binary residing within a Docker container, there is more overhead than the other approach of deploying the binary straight to AWS Lambda"})]})}function m(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,a,n)=>{n.d(a,{R:()=>o,x:()=>r});var i=n(96540);const t={},s=i.createContext(t);function o(e){const a=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:a},e.children)}}}]);