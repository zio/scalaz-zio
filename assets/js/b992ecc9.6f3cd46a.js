"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[47325],{93823:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"zio2-interop-cats2/index","title":"ZIO 2.x Interoperation with Cats 2.x","description":"Installation","source":"@site/docs/zio2-interop-cats2/index.md","sourceDirName":"zio2-interop-cats2","slug":"/zio2-interop-cats2/","permalink":"/zio2-interop-cats2/","draft":false,"unlisted":false,"editUrl":"https://github.com/zio/zio/edit/series/2.x/docs/zio2-interop-cats2/index.md","tags":[],"version":"current","frontMatter":{"id":"index","title":"ZIO 2.x Interoperation with Cats 2.x","sidebar_label":"ZIO 2.x Interop Cats 2.x"},"sidebar":"ecosystem-sidebar","previous":{"title":"Caliban Deriving","permalink":"/caliban-deriving/"},"next":{"title":"ZIO AMQP","permalink":"/zio-amqp/"}}');var r=t(74848),s=t(28453);const o={id:"index",title:"ZIO 2.x Interoperation with Cats 2.x",sidebar_label:"ZIO 2.x Interop Cats 2.x"},c=void 0,a={},l=[{value:"Installation",id:"installation",level:2},{value:"<code>ZIO</code> Cats Effect instances",id:"zio-cats-effect-instances",level:2},{value:"ConcurrentEffect",id:"concurrenteffect",level:2},{value:"Timer",id:"timer",level:3},{value:"cats-core",id:"cats-core",level:3},{value:"Example",id:"example",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sbt",children:'libraryDependencies += "dev.zio" %% "zio-interop-cats" % "22.0.0.0"\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"zio-cats-effect-instances",children:[(0,r.jsx)(n.code,{children:"ZIO"})," Cats Effect instances"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"ZIO"})," integrates with Typelevel libraries by providing an instance of ",(0,r.jsx)(n.code,{children:"ConcurrentEffect"})," for ",(0,r.jsx)(n.code,{children:"IO"})," as required, for instance, by ",(0,r.jsx)(n.code,{children:"fs2"}),", ",(0,r.jsx)(n.code,{children:"doobie"})," and ",(0,r.jsx)(n.code,{children:"http4s"}),". Actually, I lied a little bit, it is not possible to implement ",(0,r.jsx)(n.code,{children:"ConcurrentEffect"})," for any error type since ",(0,r.jsx)(n.code,{children:"ConcurrentEffect"})," extends ",(0,r.jsx)(n.code,{children:"MonadError"})," of ",(0,r.jsx)(n.code,{children:"Throwable"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"For convenience we have defined an alias as follow:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:"  type Task[A] = IO[Throwable, A]\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Therefore, we provide an instance of ",(0,r.jsx)(n.code,{children:"ConcurrentEffect[Task]"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"concurrenteffect",children:"ConcurrentEffect"}),"\n",(0,r.jsxs)(n.p,{children:["In order to get a ",(0,r.jsx)(n.code,{children:"ConcurrentEffect[Task]"})," or ",(0,r.jsx)(n.code,{children:"ConcurrentEffect[RIO[R, *]]"})," we need an implicit ",(0,r.jsx)(n.code,{children:"Runtime[R]"})," in scope. The easiest way to get it is using ",(0,r.jsx)(n.code,{children:"ZIO.runtime"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:"import cats.effect._\nimport zio._\nimport zio.interop.catz._\n\ndef getCE = {\n  ZIO.runtime.map { implicit r: Runtime[Any] =>\n    val F: ConcurrentEffect[Task] = implicitly\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Task.concurrentEffectWith"})," method can automate this pattern:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:'import cats.effect._\nimport zio._\nimport zio.interop.catz._\n\ndef fork = {\n  Task.concurrentEffectWith { implicit CE =>\n    CE.start(Task(println("Started task")))\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"timer",children:"Timer"}),"\n",(0,r.jsxs)(n.p,{children:["In order to get a ",(0,r.jsx)(n.code,{children:"cats.effect.Timer[Task]"})," instance we need an extra import:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:"import zio.interop.catz.implicits._\n"})}),"\n",(0,r.jsxs)(n.p,{children:['The reason it is not provided by the default "interop" import is that it makes testing programs that require timing capabilities hard therefore an extra import wherever needed makes reasoning about it much easier.\nIt is not a good idea to use this import as it causes limitations in testing since it uses the ',(0,r.jsx)(n.code,{children:"live"})," implementation of ",(0,r.jsx)(n.code,{children:"zio.Clock.Service"}),". If you want to retain testability, do the following instead:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:"import cats.effect._\nimport zio._\nimport zio.interop.catz._\n\nZIO.runtime[Clock].flatMap { implicit rts =>\n  val clock: Timer[Task] = rts.environment.get.toTimer\n  val ce: ConcurrentEffect[Task] = implicitly\n  \n  ce.race(clock.sleep(1.second), clock.sleep(1.second))\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"cats-core",children:"cats-core"}),"\n",(0,r.jsxs)(n.p,{children:["If you only need instances for ",(0,r.jsx)(n.code,{children:"cats-core"})," typeclasses, not ",(0,r.jsx)(n.code,{children:"cats-effect"})," import ",(0,r.jsx)(n.code,{children:"zio.interop.catz.core._"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:"import zio.interop.catz.core._\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Note that this library only has an ",(0,r.jsx)(n.code,{children:"Optional"})," dependency on cats-effect \u2013 if you or your libraries don't depend on it, this library will not add it to the classpath."]}),"\n",(0,r.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.p,{children:"The following example shows how to use ZIO with Doobie (a library for JDBC access) and FS2 (a streaming library), which both rely on Cats Effect instances:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:'import doobie.imports._\nimport fs2.Stream\nimport zio.Task\nimport zio.interop.catz._\n\nval xa: Transactor[Task] = Transactor.fromDriverManager[Task](...)\n\ndef loadUsers: Stream[Task, User] =\n  sql"""SELECT * FROM users""".query[User].stream.transact(xa)\n\nval allUsers: List[User] = unsafeRun(loadUsers.compile.toList)\n'})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var i=t(96540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);