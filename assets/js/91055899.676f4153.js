"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[76461],{62631:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"reference/di/building-dependency-graph","title":"Building Dependency Graph","description":"We have two options to build a dependency graph:","source":"@site/docs/reference/di/building-dependency-graph.md","sourceDirName":"reference/di","slug":"/reference/di/building-dependency-graph","permalink":"/reference/di/building-dependency-graph","draft":false,"unlisted":false,"editUrl":"https://github.com/zio/zio/edit/series/2.x/docs/reference/di/building-dependency-graph.md","tags":[],"version":"current","frontMatter":{"id":"building-dependency-graph","title":"Building Dependency Graph"},"sidebar":"reference-sidebar","previous":{"title":"Getting Started","permalink":"/reference/di/dependency-injection-in-zio"},"next":{"title":"Manual Layer Construction","permalink":"/reference/di/manual-layer-construction"}}');var r=i(74848),a=i(28453);const t={id:"building-dependency-graph",title:"Building Dependency Graph"},l=void 0,s={},c=[];function d(e){const n={a:"a",admonition:"admonition",code:"code",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"We have two options to build a dependency graph:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/reference/di/manual-layer-construction",children:"Manual layer construction"}),"\u2014 This method uses ZIO's composition operators such as horizontal (",(0,r.jsx)(n.code,{children:"++"}),") and vertical (",(0,r.jsx)(n.code,{children:">>>"}),") compositions."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/reference/di/automatic-layer-construction",children:"Automatic layer construction"}),"\u2014 It uses metaprogramming to automatically create the dependency graph at compile time."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Assume we have the following dependency graph with two top-level dependencies:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"           DocRepo                ++          UserRepo\n      ____/   |   \\____                       /     \\\n     /        |        \\                     /       \\\n Logging  Database  BlobStorage          Logging   Database\n                         |                  \n                      Logging            \n"})}),"\n",(0,r.jsxs)(n.p,{children:["Now, assume that we have written an application that finally needs two services: ",(0,r.jsx)(n.code,{children:"DocRepo"})," and ",(0,r.jsx)(n.code,{children:"UserRepo"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:"val myApp: ZIO[DocRepo with UserRepo, Throwable, Unit] = ZIO.attempt(???)\n"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"To create the dependency graph for this ZIO application manually, we can use the following code:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:"val appLayer: URLayer[Any, DocRepo with UserRepo] =\n  ((Logging.live ++ Database.live ++ (Logging.live >>> BlobStorage.live)) >>> DocRepo.live) ++\n    ((Logging.live ++ Database.live) >>> UserRepo.live)\n    \nval res: ZIO[Any, Throwable, Unit] = myApp.provideLayer(appLayer)\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["As the development of our application progress, the number of layers will grow, and maintaining the dependency graph manually could be tedious and hard to debug. So, we can automatically construct dependencies with friendly compile-time hints, using ",(0,r.jsx)(n.code,{children:"ZIO#provide"})," operator:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:"val res: ZIO[Any, Throwable, Unit] =\n  myApp.provide(\n    Logging.live,\n    Database.live,\n    BlobStorage.live,\n    DocRepo.live,\n    UserRepo.live\n  )\n"})}),"\n",(0,r.jsx)(n.p,{children:"The order of dependencies doesn't matter:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:"val res: ZIO[Any, Throwable, Unit] =\n  myApp.provide(\n    DocRepo.live,\n    BlobStorage.live,\n    Logging.live,\n    Database.live,\n    UserRepo.live\n  )\n"})}),"\n",(0,r.jsx)(n.p,{children:"If we miss some dependencies, it doesn't compile, and the compiler gives us the clue:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",children:"val app: ZIO[Any, Throwable, Unit] =\n  myApp.provide(\n    DocRepo.live,\n    BlobStorage.live,\n//    Logging.live,\n    Database.live,\n    UserRepo.live\n  )\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"  ZLayer Wiring Error  \n\n\u276f missing Logging\n\u276f     for DocRepo.live\n\n\u276f missing Logging\n\u276f     for UserRepo.live\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"ZIO#provide"})," method, together with its variant ",(0,r.jsx)(n.code,{children:"ZIO#provideSome"}),", is default and easier way of injecting dependencies to the environmental effect. We do not require creating the dependency graph manually, it will be automatically generated."]}),(0,r.jsxs)(n.p,{children:["In contrast, the ",(0,r.jsx)(n.code,{children:"ZIO#provideLayer"}),", and its variant ",(0,r.jsx)(n.code,{children:"ZIO#provideSomeLayer"}),", is useful for low-level and custom cases."]})]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var o=i(96540);const r={},a=o.createContext(r);function t(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);