"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[47302],{19381:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>a,contentTitle:()=>t,default:()=>c,frontMatter:()=>g,metadata:()=>i,toc:()=>s});const i=JSON.parse('{"id":"zio-logging/slf4j1-bridge","title":"SLF4J v1 bridge","description":"It is possible to use zio-logging for SLF4J loggers, usually third-party non-ZIO libraries. To do so, import the zio-logging-slf4j-bridge module for SLF4J v1 (working with JDK8):","source":"@site/docs/zio-logging/slf4j1-bridge.md","sourceDirName":"zio-logging","slug":"/zio-logging/slf4j1-bridge","permalink":"/zio-logging/slf4j1-bridge","draft":false,"unlisted":false,"editUrl":"https://github.com/zio/zio/edit/series/2.x/docs/zio-logging/slf4j1-bridge.md","tags":[],"version":"current","frontMatter":{"id":"slf4j1-bridge","title":"SLF4J v1 bridge"},"sidebar":"ecosystem-sidebar","previous":{"title":"SLF4J v2 bridge","permalink":"/zio-logging/slf4j2-bridge"},"next":{"title":"Log Metrics","permalink":"/zio-logging/metrics"}}');var r=n(74848),l=n(28453);const g={id:"slf4j1-bridge",title:"SLF4J v1 bridge"},t=void 0,a={},s=[{value:"Examples",id:"examples",level:2},{value:"SLF4J bridge with JSON console logger",id:"slf4j-bridge-with-json-console-logger",level:3},{value:"Feature changes",id:"feature-changes",level:2},{value:"Version 2.1.9",id:"version-219",level:3},{value:"Version 2.2.0",id:"version-220",level:3}];function d(e){const o={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.p,{children:["It is possible to use ",(0,r.jsx)(o.code,{children:"zio-logging"})," for SLF4J loggers, usually third-party non-ZIO libraries. To do so, import the ",(0,r.jsx)(o.code,{children:"zio-logging-slf4j-bridge"})," module for SLF4J v1 (working with JDK8):"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-scala",children:'libraryDependencies += "dev.zio" %% "zio-logging-slf4j-bridge" % "2.5.0"\n'})}),"\n",(0,r.jsxs)(o.p,{children:["and use one of the ",(0,r.jsx)(o.code,{children:"Slf4jBridge"})," layers when setting up logging:"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-scala",children:"import zio.logging.slf4j.Slf4jBridge\n\nprogram.provideCustom(Slf4jBridge.init())\n"})}),"\n",(0,r.jsxs)(o.p,{children:[(0,r.jsx)(o.code,{children:"Slf4jBridge"})," layers:"]}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.code,{children:"Slf4jBridge.init(configPath: NonEmptyChunk[String] = logFilterConfigPath)"})," - setup with ",(0,r.jsx)(o.code,{children:"LogFilter"})," from ",(0,r.jsx)(o.a,{href:"/zio-logging/log-filter#configuration",children:"filter configuration"}),", default configuration path: ",(0,r.jsx)(o.code,{children:"logger.filter"}),", default ",(0,r.jsx)(o.code,{children:"LogLevel"})," is ",(0,r.jsx)(o.code,{children:"INFO"})]}),"\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.code,{children:"Slf4jBridge.init(filter: LogFilter[Any])"})," - setup with given ",(0,r.jsx)(o.code,{children:"LogFilter"})]}),"\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.code,{children:"Slf4jBridge.initialize"})," - setup without filtering"]}),"\n"]}),"\n",(0,r.jsxs)(o.p,{children:["Need for log filtering in slf4j bridge: libraries with slf4j loggers, may have conditional logic for logging,\nwhich using functions like ",(0,r.jsx)(o.a,{href:"https://github.com/qos-ch/slf4j/blob/master/slf4j-api/src/main/java/org/slf4j/Logger.java#L170",children:"org.slf4j.Logger.isTraceEnabled()"}),".\nlogging parts may contain message and log parameters construction, which may be expensive and degrade performance of application."]}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsxs)(o.p,{children:["SLF4J logger name is stored in log annotation with key ",(0,r.jsx)(o.code,{children:"logger_name"})," (",(0,r.jsx)(o.code,{children:"zio.logging.loggerNameAnnotationKey"}),"), following log format"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-scala",children:"import zio.logging.slf4j.Slf4jBridge\nimport zio.logging.LoggerNameExtractor\n\nval loggerName = LoggerNameExtractor.loggerNameAnnotationOrTrace\nval loggerNameFormat = loggerName.toLogFormat()\n"})}),"\n",(0,r.jsx)(o.p,{children:"may be used to get logger name from log annotation or ZIO Trace."}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(o.p,{children:"SLF4J bridge with custom logger can be setup:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-scala",children:"import zio.logging.slf4j.Slf4jBridge\nimport zio.logging.consoleJsonLogger\n\nval logger = Runtime.removeDefaultLoggers >>> consoleJsonLogger() >+> Slf4jBridge.init()\n"})}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsxs)(o.p,{children:[(0,r.jsx)(o.strong,{children:"NOTE:"})," You should either use ",(0,r.jsx)(o.code,{children:"zio-logging-slf4j"})," to send all ZIO logs to an SLF4j provider (such as logback, log4j etc) OR ",(0,r.jsx)(o.code,{children:"zio-logging-slf4j-bridge"})," to send all SLF4j logs to\nZIO logging. Enabling both causes circular logging and makes no sense."]}),"\n",(0,r.jsx)(o.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(o.h3,{id:"slf4j-bridge-with-json-console-logger",children:"SLF4J bridge with JSON console logger"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-scala",children:'package zio.logging.example\n\nimport zio.logging.{ ConsoleLoggerConfig, LogAnnotation, LogFilter, LogFormat, LoggerNameExtractor, consoleJsonLogger }\nimport zio.{ ExitCode, LogLevel, Runtime, Scope, ZIO, ZIOAppArgs, ZIOAppDefault, ZLayer }\n\nimport java.util.UUID\n\nobject Slf4jBridgeExampleApp extends ZIOAppDefault {\n\n  private val slf4jLogger = org.slf4j.LoggerFactory.getLogger("SLF4J-LOGGER")\n\n  private val logFilterConfig = LogFilter.LogLevelByNameConfig(\n    LogLevel.Info,\n    "zio.logging.slf4j" -> LogLevel.Debug,\n    "SLF4J-LOGGER"      -> LogLevel.Warning\n  )\n\n  private val logFormat = LogFormat.label(\n    "name",\n    LoggerNameExtractor.loggerNameAnnotationOrTrace.toLogFormat()\n  ) + LogFormat.logAnnotation(LogAnnotation.UserId) + LogFormat.logAnnotation(\n    LogAnnotation.TraceId\n  ) + LogFormat.default\n\n  private val loggerConfig = ConsoleLoggerConfig(logFormat, logFilterConfig)\n\n  override val bootstrap: ZLayer[ZIOAppArgs, Any, Any] =\n    Runtime.removeDefaultLoggers >>> consoleJsonLogger(loggerConfig) >+> Slf4jBridge.init(loggerConfig.toFilter)\n\n  private val uuids = List.fill(2)(UUID.randomUUID())\n\n  override def run: ZIO[Scope, Any, ExitCode] =\n    for {\n      _ <- ZIO.logInfo("Start")\n      _ <- ZIO.foreachPar(uuids) { u =>\n        ZIO.succeed(slf4jLogger.info("Test {}!", "INFO")) *> ZIO.succeed(\n          slf4jLogger.warn("Test {}!", "WARNING")\n        ) @@ LogAnnotation.UserId(\n          u.toString\n        )\n      } @@ LogAnnotation.TraceId(UUID.randomUUID())\n      _ <- ZIO.logDebug("Done")\n    } yield ExitCode.success\n\n}\n'})}),"\n",(0,r.jsx)(o.p,{children:"Expected Console Output:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{children:'{"name":"zio.logging.example.Slf4jBridgeExampleApp","timestamp":"2024-02-16T08:10:45.373807+01:00","level":"INFO","thread":"zio-fiber-6","message":"Start"}\n{"name":"SLF4J-LOGGER","user_id":"d13f90ad-6b0a-45fd-bf94-1db7a0d8c0b7","trace_id":"561300a9-e6f1-4f61-8dcc-dfef476dab20","timestamp":"2024-02-16T08:10:45.421448+01:00","level":"WARN","thread":"zio-fiber-10","message":"Test WARNING!"}\n{"name":"SLF4J-LOGGER","user_id":"0f28521f-ac8f-4d8e-beeb-13c85c90c041","trace_id":"561300a9-e6f1-4f61-8dcc-dfef476dab20","timestamp":"2024-02-16T08:10:45.421461+01:00","level":"WARN","thread":"zio-fiber-9","message":"Test WARNING!"}\n{"name":"zio.logging.example.Slf4jBridgeExampleApp","timestamp":"2024-02-16T08:10:45.428162+01:00","level":"DEBUG","thread":"zio-fiber-6","message":"Done"}\n'})}),"\n",(0,r.jsx)(o.h2,{id:"feature-changes",children:"Feature changes"}),"\n",(0,r.jsx)(o.h3,{id:"version-219",children:"Version 2.1.9"}),"\n",(0,r.jsxs)(o.p,{children:["SLF4J logger name is stored in log annotation with key ",(0,r.jsx)(o.code,{children:"logger_name"})," (",(0,r.jsx)(o.code,{children:"zio.logging.loggerNameAnnotationKey"}),"),\nin previous versions, logger name was stored in log annotation with key ",(0,r.jsx)(o.code,{children:"slf4j_logger_name"})," (",(0,r.jsx)(o.code,{children:"Slf4jBridge.loggerNameAnnotationKey"}),"),\nfor backward compatibility, if there is need to use legacy annotation key, it can be done with following initialisation"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-scala",children:"import zio.logging.slf4j.Slf4jBridge\n\nprogram.provideCustom(Slf4jBridge.initialize(Slf4jBridge.loggerNameAnnotationKey))\n"})}),"\n",(0,r.jsx)(o.p,{children:"NOTE: this feature may be removed in future versions"}),"\n",(0,r.jsx)(o.p,{children:"Following log format"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-scala",children:"import zio.logging.slf4j.Slf4jBridge\nimport zio.logging.LoggerNameExtractor\n\nval loggerName = LoggerNameExtractor.annotationOrTrace(Slf4jBridge.loggerNameAnnotationKey)\nval loggerNameFormat = loggerName.toLogFormat()\n"})}),"\n",(0,r.jsx)(o.p,{children:"may be used to get logger name from log annotation or ZIO Trace."}),"\n",(0,r.jsx)(o.p,{children:"This logger name extractor can be used also in log filter, which applying log filtering by defined logger name and level:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-scala",children:'val logFilter: LogFilter[String] = LogFilter.logLevelByGroup(\n  LogLevel.Info,\n  loggerName.toLogGroup(),\n  "zio.logging.slf4j" -> LogLevel.Debug,\n  "SLF4J-LOGGER"      -> LogLevel.Warning\n)\n'})}),"\n",(0,r.jsx)(o.h3,{id:"version-220",children:"Version 2.2.0"}),"\n",(0,r.jsxs)(o.p,{children:["Deprecated log annotation with key ",(0,r.jsx)(o.code,{children:"slf4j_logger_name"})," (",(0,r.jsx)(o.code,{children:"Slf4jBridge.loggerNameAnnotationKey"}),") removed,\nonly common log annotation with key ",(0,r.jsx)(o.code,{children:"logger_name"})," (",(0,r.jsx)(o.code,{children:"zio.logging.loggerNameAnnotationKey"}),") for logger name is supported now."]})]})}function c(e={}){const{wrapper:o}={...(0,l.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,o,n)=>{n.d(o,{R:()=>g,x:()=>t});var i=n(96540);const r={},l=i.createContext(r);function g(e){const o=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:g(e.components),i.createElement(l.Provider,{value:o},e.children)}}}]);