"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[57293],{8501:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"zio-quill/logging","title":"Logging","description":"Logging to a File at Compile-Time","source":"@site/docs/zio-quill/logging.md","sourceDirName":"zio-quill","slug":"/zio-quill/logging","permalink":"/zio-quill/logging","draft":false,"unlisted":false,"editUrl":"https://github.com/zio/zio/edit/series/2.x/docs/zio-quill/logging.md","tags":[],"version":"current","frontMatter":{"id":"logging","title":"Logging"},"sidebar":"ecosystem-sidebar","previous":{"title":"Code Generation","permalink":"/zio-quill/code-generation"},"next":{"title":"Compiler performance","permalink":"/zio-quill/compiler-performance"}}');var t=i(74848),o=i(28453);const r={id:"logging",title:"Logging"},s=void 0,a={},c=[{value:"Logging to a File at Compile-Time",id:"logging-to-a-file-at-compile-time",level:2},{value:"Disable Compile-Time Console Logging",id:"disable-compile-time-console-logging",level:2},{value:"Runtime",id:"runtime",level:2},{value:"Pretty Printing",id:"pretty-printing",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"logging-to-a-file-at-compile-time",children:"Logging to a File at Compile-Time"}),"\n",(0,t.jsxs)(n.p,{children:["To write compile-time queries to a log, use the ",(0,t.jsx)(n.code,{children:"-Dquill.log.file=queries.sql"})," and specify\nthe file to be written (e.g. ",(0,t.jsx)(n.code,{children:"queries.sql"}),"). The path is based on the build root (i.e. the current-working-directory of the Java build)."]}),"\n",(0,t.jsx)(n.p,{children:"When using SBT, this parameter can be set either in your SBT_OPTS, the project-specific .sbtopts file or directly passed to the SBT command.\nIn IntelliJ this can be set under settings -> sbt -> VM Parameters."}),"\n",(0,t.jsxs)(n.p,{children:["(Also make sure that ",(0,t.jsx)(n.code,{children:'use for: "Builds"'})," is selected otherwise IntelliJ will not use SBT for the build in the first place.)"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://user-images.githubusercontent.com/1369480/163513653-b5266cd6-1bff-4792-b0d2-936d24b7e0f1.png",alt:"Screenshot from 2022-04-14 23-28-47"})}),"\n",(0,t.jsxs)(n.p,{children:["Also note that the ",(0,t.jsx)(n.code,{children:"-Dquill.macro.log.pretty=true"})," parameter works together with ",(0,t.jsx)(n.code,{children:"-Dquill.log.file"})," and will output pretty-printed\nqueries to the specified file."]}),"\n",(0,t.jsx)(n.p,{children:"For a file that looks like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"// Example.scala\npackage io.getquill\n\nobject Example {\n  case class Person(id: Int, name: String, age: Int)\n  case class Address(owner:Int, street: String)\n  val ctx = new SqlMirrorContext(PostgresDialect, Literal)\n  import ctx._\n\n  val people = run(query[Person])\n  val addresses = run(query[Person])\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"The following log will be produced:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"\n-- file: /home/me/quill-example/src/main/scala/io/getquill/Example.scala:9:19\n-- time: 2022-04-14T23:18:19.533\n\n SELECT\n   x.id,\n   x.name,\n   x.age\n FROM\n   Person x\n\n;\n\n\n-- file: /home/me/quill-example/src/main/scala/io/getquill/Example.scala:10:22\n-- time: 2022-04-14T23:18:19.9\n\n SELECT\n   x.id,\n   x.name,\n   x.age\n FROM\n   Person x\n\n;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"disable-compile-time-console-logging",children:"Disable Compile-Time Console Logging"}),"\n",(0,t.jsxs)(n.p,{children:["To disable the console logging of queries during compilation use ",(0,t.jsx)(n.code,{children:"quill.macro.log"})," option:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sbt -Dquill.macro.log=false\n"})}),"\n",(0,t.jsx)(n.h2,{id:"runtime",children:"Runtime"}),"\n",(0,t.jsxs)(n.p,{children:["Quill uses SLF4J for logging. Each context logs queries which are currently executed.\nIt also logs the list of parameters that are bound into a prepared statement if any.\nTo enable that use ",(0,t.jsx)(n.code,{children:"quill.binds.log"})," option:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"java -Dquill.binds.log=true -jar myapp.jar\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The option ",(0,t.jsx)(n.code,{children:"quill.query.tooLong"})," restricts the maximum length of logged SQL statements:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"java -Dquill.binds.log=true -Dquill.query.tooLong=10000 -jar myapp.jar\n"})}),"\n",(0,t.jsx)(n.h2,{id:"pretty-printing",children:"Pretty Printing"}),"\n",(0,t.jsxs)(n.p,{children:["Quill can pretty print compile-time produced queries by leveraging a great library\nproduced by ",(0,t.jsx)(n.a,{href:"https://github.com/vertical-blank",children:"@vertical-blank"})," which is compatible\nwith both Scala and ScalaJS. To enable this feature use the ",(0,t.jsx)(n.code,{children:"quill.macro.log.pretty"})," option:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sbt -Dquill.macro.log.pretty=true\n"})}),"\n",(0,t.jsx)(n.p,{children:"Before:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[info] /home/me/project/src/main/scala/io/getquill/MySqlTestPerson.scala:20:18: SELECT p.id, p.name, p.age, a.ownerFk, a.street, a.state, a.zip FROM Person p INNER JOIN Address a ON a.ownerFk = p.id\n"})}),"\n",(0,t.jsx)(n.p,{children:"After:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[info] /home/me/project/src/main/scala/io/getquill/MySqlTestPerson.scala:20:18:\n[info]   | SELECT\n[info]   |   p.id,\n[info]   |   p.name,\n[info]   |   p.age,\n[info]   |   a.ownerFk,\n[info]   |   a.street,\n[info]   |   a.state,\n[info]   |   a.zip\n[info]   | FROM\n[info]   |   Person p\n[info]   |   INNER JOIN Address a ON a.ownerFk = p.id\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>s});var l=i(96540);const t={},o=l.createContext(t);function r(e){const n=l.useContext(o);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);