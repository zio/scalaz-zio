"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[55085],{47395:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"guides/use-zio-macros","title":"How to use ZIO Macros?","description":"Scrapping the boilerplate with macros","source":"@site/versioned_docs/version-1.0.18/guides/howto-macros.md","sourceDirName":"guides","slug":"/guides/use-zio-macros","permalink":"/1.0.18/guides/use-zio-macros","draft":false,"unlisted":false,"editUrl":"https://github.com/zio/zio/edit/series/2.x/versioned_docs/version-1.0.18/guides/howto-macros.md","tags":[],"version":"1.0.18","frontMatter":{"id":"use-zio-macros","title":"How to use ZIO Macros?"},"sidebar":"overview_sidebar","previous":{"title":"How to Access System Information?","permalink":"/1.0.18/guides/access-system-information"},"next":{"title":"Guides","permalink":"/1.0.18/guides/"}}');var o=s(74848),r=s(28453);const t={id:"use-zio-macros",title:"How to use ZIO Macros?"},c=void 0,a={},l=[{value:"Scrapping the boilerplate with macros",id:"scrapping-the-boilerplate-with-macros",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Capability accessors",id:"capability-accessors",level:2},{value:"Installation",id:"installation",level:3},{value:"Description",id:"description",level:3},{value:"Capability tags",id:"capability-tags",level:2},{value:"Installation",id:"installation-1",level:3},{value:"Description",id:"description-1",level:3}];function d(e){const n={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"scrapping-the-boilerplate-with-macros",children:"Scrapping the boilerplate with macros"}),"\n",(0,o.jsxs)(n.p,{children:["Many libraries come together with usage best practices and repeatable code, ZIO is no different. Fortunately ZIO provides macros\nto perform these repetitive tasks for you. At the moment these are only available for Scala versions ",(0,o.jsx)(n.code,{children:"2.x"}),", however their equivalents\nfor Dotty are on our roadmap."]}),"\n",(0,o.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsx)(n.p,{children:"To enable macro expansion you need to setup your project:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["for Scala ",(0,o.jsx)(n.code,{children:">= 2.13"})," add compiler option"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-scala",children:'scalacOptions += "-Ymacro-annotations"\n'})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["for Scala ",(0,o.jsx)(n.code,{children:"< 2.13"})," add macro paradise compiler plugin"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-scala",children:'compilerPlugin(("org.scalamacros" % "paradise"  % "2.1.1") cross CrossVersion.full)\n'})}),"\n",(0,o.jsx)(n.h2,{id:"capability-accessors",children:"Capability accessors"}),"\n",(0,o.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-scala",children:'libraryDependencies += "dev.zio" %% "zio-macros" % "<zio-version>"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"description",children:"Description"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"@accessible"})," macro generates ",(0,o.jsx)(n.em,{children:"capability accessors"})," into annotated module object."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-scala",children:"import zio.{ Has, ZIO }\nimport zio.macros.accessible\n\n@accessible\nobject AccountObserver {\n  trait Service {\n    def processEvent(event: AccountEvent): UIO[Unit]\n  }\n\n  // below will be autogenerated\n  def processEvent(event: AccountEvent) =\n    ZIO.accessM[Has[AccountObserver.Service]](_.get[Service].processEvent(event))\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["For normal values, a ",(0,o.jsx)(n.code,{children:"ZIO"})," with ",(0,o.jsx)(n.code,{children:"Nothing"})," on error channel is generated.\nIf the code is throwing exceptions see ",(0,o.jsx)(n.code,{children:"@throwing"})," below."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-scala",children:"import zio.{ Has, ZIO }\nimport zio.macros.accessible\n\n@accessible\nobject Module {\n  trait Service {\n    def pureMethod(v: Something): SomethingElse\n  }\n\n  // below will be autogenerated\n  def pureMethod(v: Something): ZIO[Service, Nothing, SomethingElse] =\n    ZIO.access[Has[Module.Service]](_.get[Service].pureMethod(v))\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"@throwing"})," annotation will mark impure methods.\nUsing this annotation will request ZIO to push the error on the error channel."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-scala",children:"import zio.{ Has, ZIO }\nimport zio.macros.accessible\n\n@accessible\nobject Module {\n  trait Service {\n    @throwing\n    def impureMethod(v: Something): SomethingElse\n  }\n\n  // below will be autogenerated\n  def impureMethod(v: Something): ZIO[Service, Throwable, SomethingElse] =\n    ZIO.accessM[Has[Module.Service]](s => ZIO(s.get[Service].impureMethod(v)))\n}\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note:"})," the macro can only be applied to objects which contain a trait called ",(0,o.jsx)(n.code,{children:"Service"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"capability-tags",children:"Capability tags"}),"\n",(0,o.jsx)(n.h3,{id:"installation-1",children:"Installation"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-scala",children:'libraryDependencies += "dev.zio" %% "zio-test" % "<zio-version>"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"description-1",children:"Description"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"@mockable[A]"})," generates ",(0,o.jsx)(n.em,{children:"capability tags"})," and ",(0,o.jsx)(n.em,{children:"mock layer"})," into annotated object."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-scala",children:"import zio.test.mock.mockable\n\n@mockable[AccountObserver.Service]\nobject AccountObserverMock\n"})}),"\n",(0,o.jsx)(n.p,{children:"Will result in:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-scala",children:"import zio.{ Has, UIO, URLayer, ZLayer }\nimport zio.test.mock.{ Mock, Proxy }\n\nobject AccountObserverMock extends Mock[Has[AccountObserver.Service]] {\n\n  object ProcessEvent extends Effect[AccountEvent, Nothing, Unit]\n  object RunCommand   extends Effect[Unit, Nothing, Unit]\n\n  val compose: URLayer[Has[Proxy], AccountObserver] =\n    ZLayer.fromServiceM { proxy =>\n      withRuntime.map { rts =>\n        new AccountObserver.Service {\n          def processEvent(event: AccountEvent) = proxy(ProcessEvent, event)\n          def runCommand: UIO[Unit]           = proxy(RunCommand)\n        }\n      }\n    }\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var i=s(96540);const o={},r=i.createContext(o);function t(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);