"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[12914],{38524:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"reference/test/property-testing/shrinking","title":"Shrinking","description":"In Property-Based Testing, we specify certain properties of a program, then we ask the testing framework to generate random test data to discover counterexamples. The existence of counterexamples shows that our function, which is under the test, is not correct. Unfortunately, in almost all cases, the first counterexample is not the minimal one, and they are fairly large or complex. So it is not a pretty good sample to describe why our test is failing.","source":"@site/docs/reference/test/property-testing/shrinking.md","sourceDirName":"reference/test/property-testing","slug":"/reference/test/property-testing/shrinking","permalink":"/reference/test/property-testing/shrinking","draft":false,"unlisted":false,"editUrl":"https://github.com/zio/zio/edit/series/2.x/docs/reference/test/property-testing/shrinking.md","tags":[],"version":"current","frontMatter":{"id":"shrinking","title":"Shrinking"},"sidebar":"reference-sidebar","previous":{"title":"Built-in Generators","permalink":"/reference/test/property-testing/built-in-generators"}}');var n=s(74848),r=s(28453);const o={id:"shrinking",title:"Shrinking"},a=void 0,l={},c=[];function h(e){const t={code:"code",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"In Property-Based Testing, we specify certain properties of a program, then we ask the testing framework to generate random test data to discover counterexamples. The existence of counterexamples shows that our function, which is under the test, is not correct. Unfortunately, in almost all cases, the first counterexample is not the minimal one, and they are fairly large or complex. So it is not a pretty good sample to describe why our test is failing."}),"\n",(0,n.jsx)(t.p,{children:"Shrinking is a mechanism that tries to find the smallest counterexample, which is the root cause of the test failure. So it helps a developer to find out why the test is failing."}),"\n",(0,n.jsx)(t.p,{children:"Finding the smallest failing case is somehow cumbersome and requires many attempts. As a developer, we do not need to do shrinking ourselves. All generators in ZIO Test have built-in shrinkers, so when we test properties, in case of test failures, the ZIO Test attempts to reduce the counterexamples forward their own zero points."}),"\n",(0,n.jsxs)(t.p,{children:["Let's write a ",(0,n.jsx)(t.code,{children:"reverse"})," function with an incorrect implementation:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-scala",children:"def reverse[T](list: List[T]): List[T] =\n  if (list.length > 6) list.reverse.dropRight(1) else list.reverse\n"})}),"\n",(0,n.jsx)(t.p,{children:"We know that if we reverse a list twice, it should give us the original list, so let's check this property:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-scala",children:'import zio.test._\n\nsuite("ReverseSpec"){\n  // \u2200 xs. reverse(reverse(xs)) == xs\n  test("reversing a list twice must give the original list")(\n    check(Gen.listOf(Gen.int)) { list =>\n      assertTrue(reverse(reverse(list)) == list)\n    }\n  )\n}\n'})}),"\n",(0,n.jsx)(t.p,{children:"The following messages, is a sample output of the test renderer, after running the test:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"- ReverseSpec\n  - reversing a list twice must give the original list\n    Test failed after 7 iterations with input: List(0, 0, 0, 0, 0, 0, 0)\n    Original input before shrinking was: List(724856966, 1976458409, -940069360, -191508820, -291932258, 1296893186, 2010410723, 1134770522, 1260002835)\n    \u2717 List(0, 0, 0, 0, 0, 0) was not equal to List(0, 0, 0, 0, 0, 0, 0)\n    reverse(reverse(list)) == list\n    reverse(reverse(list)) = List(0, 0, 0, 0, 0, 0)\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The initial failing input discovered by ZIO Test is ",(0,n.jsx)(t.code,{children:"List(724856966, 1976458409, -940069360, -191508820, -291932258, 1296893186, 2010410723, 1134770522, 1260002835)"}),". The ZIO Test then tries to find the simplest counterexample which is ",(0,n.jsx)(t.code,{children:"List(0, 0, 0, 0, 0, 0, 0)"}),". So the property still fails with the final shrunk value. The original input is a list of 9 somewhat useless numbers, while after shrinking, we have a list of 7 zero numbers, so we can find the bug faster."]})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>a});var i=s(96540);const n={},r=i.createContext(n);function o(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);