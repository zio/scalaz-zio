"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[68847],{63628:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"zio-optics/index","title":"Introduction to ZIO Optics","description":"ZIO Optics is a library that makes it easy to modify parts of larger data structures based on a single representation of an optic as a combination of a getter and setter.","source":"@site/docs/zio-optics/index.md","sourceDirName":"zio-optics","slug":"/zio-optics/","permalink":"/zio-optics/","draft":false,"unlisted":false,"editUrl":"https://github.com/zio/zio/edit/series/2.x/docs/zio-optics/index.md","tags":[],"version":"current","frontMatter":{"id":"index","title":"Introduction to ZIO Optics","sidebar_label":"ZIO Optics"},"sidebar":"ecosystem-sidebar","previous":{"title":"Use Cases","permalink":"/zio-nio/use-cases"},"next":{"title":"Understanding Optics","permalink":"/zio-optics/understanding-optics"}}');var i=s(74848),o=s(28453);const a={id:"index",title:"Introduction to ZIO Optics",sidebar_label:"ZIO Optics"},r=void 0,c={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Installation",id:"installation",level:2},{value:"Example",id:"example",level:2},{value:"Resources",id:"resources",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://github.com/zio/zio-optics",children:"ZIO Optics"})," is a library that makes it easy to modify parts of larger data structures based on a single representation of an optic as a combination of a getter and setter."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://github.com/zio/zio/wiki/Project-Stages",children:(0,i.jsx)(t.img,{src:"https://img.shields.io/badge/Project%20Stage-Development-green.svg",alt:"Development"})})," ",(0,i.jsx)(t.img,{src:"https://github.com/zio/zio-optics/workflows/CI/badge.svg",alt:"CI Badge"})," ",(0,i.jsx)(t.a,{href:"https://oss.sonatype.org/content/repositories/releases/dev/zio/zio-optics_2.13/",children:(0,i.jsx)(t.img,{src:"https://img.shields.io/nexus/r/https/oss.sonatype.org/dev.zio/zio-optics_2.13.svg?label=Sonatype%20Release",alt:"Sonatype Releases"})})," ",(0,i.jsx)(t.a,{href:"https://oss.sonatype.org/content/repositories/snapshots/dev/zio/zio-optics_2.13/",children:(0,i.jsx)(t.img,{src:"https://img.shields.io/nexus/s/https/oss.sonatype.org/dev.zio/zio-optics_2.13.svg?label=Sonatype%20Snapshot",alt:"Sonatype Snapshots"})})," ",(0,i.jsx)(t.a,{href:"https://javadoc.io/doc/dev.zio/zio-optics-docs_2.13",children:(0,i.jsx)(t.img,{src:"https://javadoc.io/badge2/dev.zio/zio-optics-docs_2.13/javadoc.svg",alt:"javadoc"})})," ",(0,i.jsx)(t.a,{href:"https://github.com/zio/zio-optics",children:(0,i.jsx)(t.img,{src:"https://img.shields.io/github/stars/zio/zio-optics?style=social",alt:"ZIO Optics"})})]}),"\n",(0,i.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(t.p,{children:"When we are working with immutable nested data structures, updating and reading operations could be tedious with lots of boilerplates. Optics is a functional programming construct that makes these operations more clear and readable."}),"\n",(0,i.jsx)(t.p,{children:"Key features of ZIO Optics:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Unified Optic Data Type"})," \u2014 All the data types like ",(0,i.jsx)(t.code,{children:"Lens"}),", ",(0,i.jsx)(t.code,{children:"Prism"}),", ",(0,i.jsx)(t.code,{children:"Optional"}),", and so forth are type aliases for the core ",(0,i.jsx)(t.code,{children:"Optic"})," data type."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Composability"})," \u2014 We can compose optics to create more advanced ones."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Embracing the Tremendous Power of Concretion"})," \u2014 Using concretion instead of unnecessary abstractions, makes the API more ergonomic and easy to use."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Integration with ZIO Data Types"})," \u2014 It supports effectful and transactional optics that works with ZIO data structures like ",(0,i.jsx)(t.code,{children:"Ref"})," and ",(0,i.jsx)(t.code,{children:"TMap"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Helpful Error Channel"})," \u2014 Like ZIO, the ",(0,i.jsx)(t.code,{children:"Optics"})," data type has error channels to include failure details."]}),"\n"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Zero dependencies"})," - No dependencies other than ZIO itself."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"No unnecessary abstractions"})," - Concrete representation makes it easy to learn."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["The optic also handles the possibility of failure for us, failing with an ",(0,i.jsx)(t.code,{children:"OpticFailure"})," that is a subtype of ",(0,i.jsx)(t.code,{children:"Throwable"})," and contains a helpful error message if the key cannot be found."]}),"\n",(0,i.jsxs)(t.p,{children:["ZIO Optics makes it easy to compose more complex optics from simpler ones, to define optics for your own data types, and to work with optics that use ",(0,i.jsx)(t.code,{children:"ZIO"})," or ",(0,i.jsx)(t.code,{children:"STM"})," effects."]}),"\n",(0,i.jsx)(t.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsxs)(t.p,{children:["In order to use this library, we need to add the following line in our ",(0,i.jsx)(t.code,{children:"build.sbt"})," file:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",children:'libraryDependencies += "dev.zio" %% "zio-optics" % "0.2.2"\n'})}),"\n",(0,i.jsx)(t.h2,{id:"example",children:"Example"}),"\n",(0,i.jsxs)(t.p,{children:["ZIO Optics makes it easy to modify parts of larger data structures. For example, say we have a web application where users can vote on which of various topics they are interested in. We maintain our state of how many votes each topic has received as a ",(0,i.jsx)(t.code,{children:"Ref[Map[String, Int]]"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",children:"import zio._\n\nlazy val voteRef: Ref[Map[String, Int]] =\n  ???\n"})}),"\n",(0,i.jsx)(t.p,{children:"If we want to increment the number of votes for one of the topics here is what it would look like:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",children:'def incrementVotes(topic: String): Task[Unit] =\n  voteRef.modify { voteMap =>\n    voteMap.get(topic) match {\n      case Some(votes) =>\n        (ZIO.unit, voteMap + (topic -> (votes + 1)))\n      case None        =>\n        val message = s"voteMap $voteMap did not contain topic $topic"\n        (ZIO.fail(new NoSuchElementException(message)), voteMap)\n    }\n  }.flatten\n'})}),"\n",(0,i.jsxs)(t.p,{children:["This is alright, but there is a lot of code here for a relatively simple operation of incrementing one of the keys. We have to get the value from the ",(0,i.jsx)(t.code,{children:"Ref"}),", then get the value from the ",(0,i.jsx)(t.code,{children:"Map"}),", and finally set the new value in the ",(0,i.jsx)(t.code,{children:"Map"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"We also have to explicitly handle the possibility that the value is not in the map. And this is all for a relatively simple data structure!"}),"\n",(0,i.jsx)(t.p,{children:"Here is what this would look like with ZIO Optics."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",children:"import zio.optics._\n\ndef incrementVotes(topic: String): Task[Unit] =\n  voteRef.key(topic).update(_ + 1)\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"key"}),' optic "zooms in" on part of a larger structure, in this case transforming the ',(0,i.jsx)(t.code,{children:"Ref[Map[String, Int]]"})," into a ",(0,i.jsx)(t.code,{children:"Ref"})," that accesses the value at the specified key. We can then simply call the ",(0,i.jsx)(t.code,{children:"update"})," operator on ",(0,i.jsx)(t.code,{children:"Ref"})," to increment the value."]}),"\n",(0,i.jsx)(t.p,{children:"Let's try another example. We are going to update a nested data structure using ZIO Optics:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",children:'import zio.optics._\n\ncase class Developer(name: String, manager: Manager)\ncase class Manager(name: String, rating: Rating)\ncase class Rating(upvotes: Int, downvotes: Int)\n\nval developerLens = Lens[Developer, Manager](\n  get = developer => Right(developer.manager),\n  set = manager => developer => Right(developer.copy(manager = manager))\n)\n\nval managerLens = Lens[Manager, Rating](\n  get = manager => Right(manager.rating),\n  set = rating => manager => Right(manager.copy(rating = rating))\n)\n\nval ratingLens = Lens[Rating, Int](\n  get = rating => Right(rating.upvotes),\n  set = upvotes => rating => Right(rating.copy(upvotes = upvotes))\n)\n\n// Composing lenses\nval optic = developerLens >>> managerLens >>> ratingLens\n\nval jane    = Developer("Jane", Manager("Steve", Rating(0, 0)))\nval updated = optic.update(jane)(_ + 1)\n\nprintln(updated)\n'})}),"\n",(0,i.jsx)(t.h2,{id:"resources",children:"Resources"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://www.youtube.com/watch?v=-km5ohYhJa4",children:"Zymposium - Optics"})," by Adam Fraser and Kit Langton (June 2021) \u2014 Optics are great tools for working with parts of larger data structures and come up in disguise in many places such as ZIO Test assertions."]}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>r});var n=s(96540);const i={},o=n.createContext(i);function a(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);